<div class="main-block">
  <h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Ç–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞)</h2>
  <p>–ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤ Firestore.</p>

  <button id="refreshBtn" class="button primary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>

  <div id="usersList" class="users-list"></div>
  <p id="userCount" class="small text-right"></p>
</div>

<style>
  .users-list {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .user-card {
    background: white;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    line-height: 1.4;
  }
  .user-card b {
    color: #6c63ff;
  }
  .user-card small {
    color: #666;
    font-size: 0.9em;
  }
</style>

<script type="module">
  const refreshBtn = document.getElementById("refreshBtn");
  const list = document.getElementById("usersList");
  const countEl = document.getElementById("userCount");

  async function loadUsers() {
    list.innerHTML = `<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>`;
    try {
      const res = await fetch("https://us-central1-smart-vision-888.cloudfunctions.net/listUsers");
      const data = await res.json();

      if (!data.ok || !Array.isArray(data.users)) throw new Error("Invalid data");

      if (data.users.length === 0) {
        list.innerHTML = `<p>–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>`;
        countEl.textContent = "";
        return;
      }

      list.innerHTML = data.users.map((u, i) => `
        <div class="user-card">
          <b>${i + 1}. ${u.name || "–ë–µ–∑ –∏–º–µ–Ω–∏"}</b>  
          <div>${u.email || "-"}</div>
          <small>–°–æ–∑–¥–∞–Ω: ${u.createdAt ? new Date(u.createdAt).toLocaleString() : "-"}</small><br>
          <small>–û–±–Ω–æ–≤–ª—ë–Ω: ${u.updatedAt ? new Date(u.updatedAt).toLocaleString() : "-"}</small>
        </div>
      `).join("");

      countEl.textContent = `–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.users.length}`;
    } catch (err) {
      console.error(err);
      list.innerHTML = `<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>`;
    }
  }

  refreshBtn.addEventListener("click", loadUsers);
  loadUsers();
</script>
