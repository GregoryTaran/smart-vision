<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Vision WebRTC Audio Test</title>
</head>
<body>
  <h2>ðŸŽ§ Vision WebRTC Test</h2>
  <button id="startCall">ðŸ“ž Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð²Ð¾Ð½Ð¾Ðº</button>
  <button id="answerCall">âœ… ÐžÑ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ</button>
  <textarea id="signal" placeholder="Ð’ÑÑ‚Ð°Ð²ÑŒ ÑÑŽÐ´Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°"></textarea>
  <audio id="remoteAudio" autoplay></audio>

  <script>
    const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
    const signalBox = document.getElementById('signal');
    const audio = document.getElementById('remoteAudio');

    pc.onicecandidate = e => {
      if (e.candidate) return;
      signalBox.value = JSON.stringify(pc.localDescription);
    };
    pc.ontrack = e => (audio.srcObject = e.streams[0]);

    async function getMic() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      stream.getTracks().forEach(t => pc.addTrack(t, stream));
    }

    document.getElementById('startCall').onclick = async () => {
      await getMic();
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
    };

    document.getElementById('answerCall').onclick = async () => {
      await getMic();
      const desc = JSON.parse(signalBox.value);
      await pc.setRemoteDescription(desc);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      signalBox.value = JSON.stringify(answer);
    };

    // Ð²ÑÑ‚Ð°Ð²ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð¾Ñ‚ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ°
    signalBox.addEventListener('input', async () => {
      try {
        const data = JSON.parse(signalBox.value);
        if (!pc.currentRemoteDescription) await pc.setRemoteDescription(data);
      } catch {}
    });
  </script>
</body>
</html>
