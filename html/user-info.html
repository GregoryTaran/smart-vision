<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Информация о пользователе | Smart Vision</title>
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/dashboard.css" />
</head>
<body>
  <div class="client-bar">
    <span id="user-info"></span>
    <a id="logout" class="logout-link">Выйти</a>
  </div>

  <div class="main-block">
    <h2>Информация о пользователе</h2>
    <div id="info" class="user-card"></div>
  </div>

  <script type="module">
    const user = JSON.parse(localStorage.getItem("user"));
    const infoTop = document.getElementById("user-info");
    const infoDiv = document.getElementById("info");

    if (!user || !user.email || !user.name) {
      window.location.href = "/html/login.html";
    } else {
      infoTop.textContent = `${user.name} (${user.email})`;
    }

    document.getElementById("logout").addEventListener("click", () => {
      localStorage.removeItem("user");
      window.location.href = "/html/login.html";
    });

    async function getUserInfo() {
      const userInfo = {
        "Имя": user.name,
        "E-mail": user.email,
        "Время входа": new Date().toLocaleString(),
        "Язык браузера": navigator.language,
        "Платформа": navigator.platform,
        "Агент": navigator.userAgent,
        "Ширина экрана": window.screen.width + " px",
        "Высота экрана": window.screen.height + " px"
      };

      try {
        const res = await fetch("https://ipapi.co/json/");
        const data = await res.json();
        userInfo["IP"] = data.ip;
        userInfo["Страна"] = data.country_name;
        userInfo["Город"] = data.city;
        userInfo["Провайдер"] = data.org;
      } catch {
        userInfo["IP"] = "Не удалось получить";
      }

      infoDiv.innerHTML = Object.entries(userInfo)
        .map(([k, v]) => `<p><strong>${k}:</strong> ${v}</p>`)
        .join("");
    }

    getUserInfo();
  </script>
</body>
</html>
